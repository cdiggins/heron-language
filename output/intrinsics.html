<html><head><title>heron:intrinsics:0.1</title>
<link rel="stylesheet" type="text/css" href="styles.css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
</head>
<body>
<div class="code hideTypes"><span class="button">Toggle Types</span><span class="keyword">language</span> <span class="langVer">heron:std:0.1</span><span class="delimiter">;</span>

<span class="lineComment">// Describes the core functionality provided by the run-time.</span>
<span class="keyword">module</span> <span class="moduleName">heron:intrinsics:0.1</span>
<span class="delimiter">{</span>
    <span class="lineComment">// Built-in types </span>
    <span class="keyword">type</span> <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">type</span> <span class="identifier">Float2</span><span class="delimiter">;</span>
    <span class="keyword">type</span> <span class="identifier">Float3</span><span class="delimiter">;</span> 
    <span class="keyword">type</span> <span class="identifier">Float4</span><span class="delimiter">;</span> 
    <span class="keyword">type</span> <span class="identifier">Int</span><span class="delimiter">;</span>
    <span class="keyword">type</span> <span class="identifier">Bool</span><span class="delimiter">;</span> 
    <span class="keyword">type</span> <span class="identifier">Array</span><span class="delimiter">;</span> 
    <span class="keyword">type</span> <span class="identifier">ArrayBuilder</span><span class="delimiter">;</span>
    <span class="keyword">type</span> <span class="identifier">Func</span><span class="delimiter">;</span>
    <span class="keyword">type</span> <span class="identifier">Any</span><span class="delimiter">;</span>
    <span class="keyword">type</span> <span class="identifier">Mesh</span><span class="delimiter">;</span>

    <span class="lineComment">// Intrinsic (built-in) functions. </span>
    <span class="keyword">intrinsic</span> <span class="funcName">float</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>

    <span class="keyword">intrinsic</span> <span class="funcName">float2</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float2</span><span class="delimiter">;</span>    
    <span class="keyword">intrinsic</span> <span class="funcName">u</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">v</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    
    <span class="keyword">intrinsic</span> <span class="funcName">float3</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">z</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float3</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">x</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">y</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">z</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>

    <span class="keyword">intrinsic</span> <span class="funcName">float4</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float3</span><span class="delimiter">,</span> <span class="funcParamName">w</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float4</span><span class="delimiter">;</span>    
    <span class="keyword">intrinsic</span> <span class="funcName">xyz</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float4</span><span class="delimiter">)</span>: <span class="identifier">Float3</span><span class="delimiter">;</span>    
    <span class="keyword">intrinsic</span> <span class="funcName">w</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float4</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>    

    <span class="lineComment">// Todo: eventually provide Float2, Float3, Float4 versions of these.</span>
    <span class="lineComment">// This is because a lot of hardware supports these at the lowest-level. </span>
    <span class="lineComment">// Implementing them in a high-level language is fine as a fall-back. </span>
    <span class="keyword">intrinsic</span> <span class="funcName">abs</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">acos</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">asin</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">atan</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">atan2</span><span class="delimiter">(</span><span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">ceil</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">clamp</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">min</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">max</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">cos</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">exp</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">floor</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">log</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">pow</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">round</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">sin</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">sign</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">sqrt</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">tan</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>    

    <span class="lineComment">// Binary operators </span>
    <span class="keyword">intrinsic</span> <span class="funcName">op+</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">T</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op-</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">T</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op*</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">T</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op/</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">T</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op%</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">T</span><span class="delimiter">;</span>
    
    <span class="lineComment">// Comparison operators </span>
    <span class="keyword">intrinsic</span> <span class="funcName">op&gt;</span>  <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op&gt;=</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op&lt;</span>  <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op&lt;=</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>

    <span class="lineComment">// Specialized binary operators </span>
    <span class="keyword">intrinsic</span> <span class="funcName">op+</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Int</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op-</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Int</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op*</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Int</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op/</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Int</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op%</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Int</span><span class="delimiter">;</span>

    <span class="keyword">intrinsic</span> <span class="funcName">op+</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op-</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op*</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op/</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op%</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>

    <span class="functionDef"><span class="functionType">(Func Float2 Float2 Float2)</span><span class="keyword">function</span> <span class="funcName">op+</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float2</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float2</span> <span class="operator">=</span> <span class="varName">float2</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">+</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">+</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float2 Float2 Float2)</span><span class="keyword">function</span> <span class="funcName">op-</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float2</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float2</span> <span class="operator">=</span> <span class="varName">float2</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">-</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">-</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float2 Float2 Float2)</span><span class="keyword">function</span> <span class="funcName">op*</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float2</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float2</span> <span class="operator">=</span> <span class="varName">float2</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">*</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">*</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float2 Float2 Float2)</span><span class="keyword">function</span> <span class="funcName">op/</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float2</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float2</span> <span class="operator">=</span> <span class="varName">float2</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">/</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">/</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float2 Float2 Float2)</span><span class="keyword">function</span> <span class="funcName">op%</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float2</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>: <span class="identifier">Float2</span> <span class="operator">=</span> <span class="varName">float2</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">%</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">%</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Float3 Float3 Float3)</span><span class="keyword">function</span> <span class="funcName">op+</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float3</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float3</span> <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">+</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">+</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">z</span> <span class="operator">+</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">z</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float3 Float3 Float3)</span><span class="keyword">function</span> <span class="funcName">op-</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float3</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float3</span> <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">-</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">-</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">z</span> <span class="operator">-</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">z</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float3 Float3 Float3)</span><span class="keyword">function</span> <span class="funcName">op*</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float3</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float3</span> <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">*</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">*</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">z</span> <span class="operator">*</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">z</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float3 Float3 Float3)</span><span class="keyword">function</span> <span class="funcName">op/</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float3</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float3</span> <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">/</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">/</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">z</span> <span class="operator">/</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">z</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float3 Float3 Float3)</span><span class="keyword">function</span> <span class="funcName">op%</span> <span class="delimiter">(</span><span class="funcParamName">a</span>: <span class="identifier">Float3</span><span class="delimiter">,</span> <span class="funcParamName">b</span>: <span class="identifier">Float3</span><span class="delimiter">)</span>: <span class="identifier">Float3</span> <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="varName">a</span><span class="operator">.</span><span class="identifier">x</span> <span class="operator">%</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">y</span> <span class="operator">%</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="varName">a</span><span class="operator">.</span><span class="identifier">z</span> <span class="operator">%</span> <span class="varName">b</span><span class="operator">.</span><span class="identifier">z</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Equality operators </span>
    </span><span class="keyword">intrinsic</span> <span class="funcName">op!=</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op==</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>

    <span class="lineComment">// Boolean operators</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op&amp;&</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Bool</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Bool</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op||</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Bool</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Bool</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op^^</span> <span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Bool</span><span class="delimiter">,</span> <span class="funcParamName">y</span>: <span class="identifier">Bool</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>

    <span class="lineComment">// Non-binary operators. These have identifier names.</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op_not</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Bool</span><span class="delimiter">)</span>: <span class="identifier">Bool</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op_negate</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Float</span><span class="delimiter">)</span>: <span class="identifier">Float</span><span class="delimiter">;</span>

    <span class="lineComment">// Array functions </span>
    <span class="keyword">intrinsic</span> <span class="funcName">array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">n</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">f</span>: <span class="identifier">Func</span><span class="operator">&lt;</span><span class="identifier">Int</span><span class="delimiter">,</span> <span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">count</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">Int</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">at</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">i</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">T</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">op..</span><span class="delimiter">(</span><span class="funcParamName">from</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">to</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Int</span><span class="operator">&gt;</span><span class="delimiter">;</span>

    <span class="lineComment">// Array builder functions</span>
    <span class="keyword">intrinsic</span> <span class="funcName">mutable</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">push</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">pushMany</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">ys</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">set</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">i</span>: <span class="identifier">Int</span><span class="delimiter">,</span> <span class="funcParamName">x</span>: <span class="identifier">T</span><span class="delimiter">)</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">immutable</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">ArrayBuilder</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">;</span>

    <span class="lineComment">// Some helpers (todo: move to a separate library)</span>
    <span class="lineComment">//function array(v: Float2) = [v.x, v.y];    </span>
    <span class="functionDef"><span class="functionType">(Func Float3 (Array Float))</span><span class="keyword">function</span> <span class="funcName">array</span><span class="delimiter">(</span><span class="funcParamName">v</span>: <span class="identifier">Float3</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="operator">[</span><span class="varName">v</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">v</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="varName">v</span><span class="operator">.</span><span class="identifier">z</span><span class="operator">]</span><span class="delimiter">;</span>
    <span class="lineComment">//function array(v: Float4) = [v.x, v.y, v.z, v.w];</span>

    <span class="lineComment">//function float2(xs) = float2(xs[0], xs[1]);</span>
    </span><span class="functionDef"><span class="functionType">(Func (Array Float) Float3)</span><span class="keyword">function</span> <span class="funcName">float3</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">xs</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">xs</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="lineComment">//function float4(xs) = float4(xs[0], xs[1], xs[2], xs[3]);    </span>

    <span class="lineComment">// Force an evaluation of an array into memory. Used for debugging, or optimization. </span>
    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">reify</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">mutable</span><span class="operator">.</span><span class="identifier">immutable</span><span class="delimiter">;</span>

    <span class="lineComment">// Indexing operator</span>
    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int T0)</span><span class="keyword">function</span> <span class="funcName">op[]</span> <span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">(</span><span class="funcParamName">xs</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">T</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">i</span>: <span class="identifier">Int</span><span class="delimiter">)</span>: <span class="identifier">T</span>
        <span class="operator">=</span> <span class="varName">at</span><span class="delimiter">(</span><span class="varName">xs</span><span class="delimiter">,</span> <span class="varName">i</span><span class="delimiter">)</span><span class="delimiter">;</span>    

    <span class="lineComment">// A couple of useful constants </span>
    </span><span class="keyword">var</span> <span class="varNameDecl">pi</span> <span class="operator">=</span> <span class="number">3.14159265358979323846</span><span class="delimiter">;</span>
    <span class="keyword">var</span> <span class="varNameDecl">e</span> <span class="operator">=</span> <span class="number">2.71828182845904523536</span><span class="delimiter">;</span>

    <span class="lineComment">// Some thing we need for now.</span>
    <span class="keyword">intrinsic</span> <span class="funcName">print</span><span class="delimiter">(</span><span class="funcParamName">x</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">assert</span><span class="delimiter">(</span><span class="funcParamName">x</span>: <span class="identifier">Bool</span><span class="delimiter">)</span><span class="delimiter">;</span>    

    <span class="lineComment">// Geometry stuff</span>
    <span class="keyword">intrinsic</span> <span class="funcName">mesh</span><span class="delimiter">(</span><span class="funcParamName">vertexBuffer</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Float3</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">indexBuffer</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Int</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">uvBuffer</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Float3</span><span class="operator">&gt;</span><span class="delimiter">,</span> <span class="funcParamName">colorBuffer</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Float3</span><span class="operator">&gt;</span><span class="delimiter">)</span>: <span class="identifier">Mesh</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">vertexBuffer</span><span class="delimiter">(</span><span class="funcParamName">mesh</span>: <span class="identifier">Mesh</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Float3</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">indexBuffer</span><span class="delimiter">(</span><span class="funcParamName">mesh</span>: <span class="identifier">Mesh</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Int</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">uvBuffer</span><span class="delimiter">(</span><span class="funcParamName">mesh</span>: <span class="identifier">Mesh</span><span class="delimiter">)</span>:  <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Float3</span><span class="operator">&gt;</span><span class="delimiter">;</span>
    <span class="keyword">intrinsic</span> <span class="funcName">colorBuffer</span><span class="delimiter">(</span><span class="funcParamName">mesh</span>: <span class="identifier">Mesh</span><span class="delimiter">)</span>: <span class="identifier">Array</span><span class="operator">&lt;</span><span class="identifier">Float3</span><span class="operator">&gt;</span><span class="delimiter">;</span>
<span class="delimiter">}</span>
</div>
</body></html>
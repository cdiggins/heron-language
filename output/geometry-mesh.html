<html><head><title>heron:geometry.mesh:0.1</title>
<link rel="stylesheet" type="text/css" href="styles.css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
</head>
<body>
<div class="code hideTypes"><span class="button">Toggle Types</span><span class="keyword">language</span> <span class="langVer">heron:std:0.1</span><span class="delimiter">;</span>

<span class="lineComment">// https://prideout.net/blog/?p=44</span>
<span class="lineComment">// https://github.com/mrdoob/three.js/blob/master/src/geometries/ParametricGeometry.js</span>
<span class="lineComment">// https://github.com/mrdoob/three.js/blob/master/examples/js/ParametricGeometries.js</span>
<span class="lineComment">// https://paulbourke.net/geometry/</span>
<span class="lineComment">// https://github.com/mrdoob/three.js/tree/master/src/geometries</span>

<span class="lineComment">// TODO: https://github.com/mrdoob/three.js/blob/master/examples/js/CurveExtras.js</span>
<span class="lineComment">// TODO: https://github.com/mrdoob/three.js/blob/master/src/math/Color.js</span>
<span class="lineComment">// TODO: extrude, lathe, spirograph, colors (See tubeGeometry in Three.JS)</span>
<span class="lineComment">// TODO: https://github.com/mrdoob/three.js/blob/master/examples/js/geometries/TeapotBufferGeometry.js</span>

<span class="keyword">module</span> <span class="moduleName">heron:geometry.mesh:0.1</span>
<span class="delimiter">{</span>
    <span class="keyword">import</span> <span class="moduleName">heron:std.array:0.1</span><span class="delimiter">;</span>
    <span class="keyword">import</span> <span class="moduleName">heron:geometry.vector:0.1</span><span class="delimiter">;</span>

    <span class="lineComment">// Alternative constructors</span>

    <span class="functionDef"><span class="functionType">(Func (Array Float3) Mesh)</span><span class="keyword">function</span> <span class="funcName">mesh</span><span class="delimiter">(</span><span class="funcParamName">vertexBuffer</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">vertexBuffer</span><span class="delimiter">,</span> <span class="varName">vertexBuffer</span><span class="operator">.</span><span class="identifier">indices</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func T0 T1 T2)</span><span class="keyword">function</span> <span class="funcName">mesh</span><span class="delimiter">(</span><span class="funcParamName">vertexBuffer</span><span class="delimiter">,</span> <span class="funcParamName">indexBuffer</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">vertexBuffer</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Float3) (Array Int) Mesh)</span><span class="keyword">function</span> <span class="funcName">mesh</span><span class="delimiter">(</span><span class="funcParamName">vertexBuffer</span><span class="delimiter">,</span> <span class="funcParamName">indexBuffer</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">vertexBuffer</span><span class="delimiter">,</span> <span class="varName">indexBuffer</span><span class="delimiter">,</span> <span class="varName">vertexBuffer</span><span class="operator">.</span><span class="identifier">setAll</span><span class="delimiter">(</span><span class="varName">origin</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Float3) (Array Int) (Array Float3) Mesh)</span><span class="keyword">function</span> <span class="funcName">mesh</span><span class="delimiter">(</span><span class="funcParamName">vertexBuffer</span><span class="delimiter">,</span> <span class="funcParamName">indexBuffer</span><span class="delimiter">,</span> <span class="funcParamName">uvBuffer</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">vertexBuffer</span><span class="delimiter">,</span> <span class="varName">indexBuffer</span><span class="delimiter">,</span> <span class="varName">uvBuffer</span><span class="delimiter">,</span> <span class="varName">vertexBuffer</span><span class="operator">.</span><span class="identifier">setAll</span><span class="delimiter">(</span><span class="varName">origin</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Platonic solids</span>

    </span><span class="keyword">var</span> <span class="varNameDecl">tetrahedron</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span>
        <span class="operator">[</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>
            <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>
            <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span>
        <span class="operator">]</span><span class="operator">.</span><span class="identifier">toVectors</span><span class="delimiter">,</span>
        <span class="operator">[</span>
            <span class="number">2</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>
            <span class="number">2</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">1</span>
        <span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="keyword">var</span> <span class="varNameDecl">cube</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span>
        <span class="operator">[</span>
            <span class="lineComment">// front</span>
            <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span>
            <span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span>
            <span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span>
            <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span>
            <span class="lineComment">// back</span>
            <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>
            <span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>
            <span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>
            <span class="operator">-</span><span class="number">1.0</span><span class="delimiter">,</span>  <span class="number">1.0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1.0</span>
        <span class="operator">]</span><span class="operator">.</span><span class="identifier">toVectors</span><span class="delimiter">,</span>
        <span class="operator">[</span>
            <span class="lineComment">// front</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>
            <span class="lineComment">// right</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>
            <span class="lineComment">// back</span>
            <span class="number">7</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span>
            <span class="lineComment">// left</span>
            <span class="number">4</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span>
            <span class="lineComment">// bottom</span>
            <span class="number">4</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span>
            <span class="lineComment">// top</span>
            <span class="number">3</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> <span class="number">3</span>
        <span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// https://github.com/mrdoob/three.js/blob/master/src/geometries/OctahedronGeometry.js</span>
    <span class="keyword">var</span> <span class="varNameDecl">octahedron</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span>
        <span class="operator">[</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> 	<span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>	<span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>	<span class="number">0</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span>
        <span class="operator">]</span><span class="operator">.</span><span class="identifier">toVectors</span><span class="delimiter">,</span>
        <span class="operator">[</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span>	<span class="number">0</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span>	<span class="number">0</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span>	<span class="number">1</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span>	<span class="number">1</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span>	<span class="number">1</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">2</span>
        <span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// https://github.com/mrdoob/three.js/blob/master/src/geometries/DodecahedronGeometry.js</span>
    <span class="keyword">var</span> <span class="varNameDecl">dodecahedron</span> <span class="operator">=</span>
        <span class="keyword">var</span> <span class="varNameDecl">t</span> <span class="operator">=</span> <span class="delimiter">(</span><span class="number">1</span> <span class="operator">+</span> <span class="varName">sqrt</span><span class="delimiter">(</span><span class="number">5</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="operator">/</span> <span class="number">2</span> <span class="keyword">in</span>
        <span class="keyword">var</span> <span class="varNameDecl">r</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">/</span> <span class="varName">t</span> <span class="keyword">in</span>
        <span class="varName">mesh</span><span class="delimiter">(</span><span class="operator">[</span>
            <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span>	<span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>
            <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>

            <span class="lineComment">// (0, +/-1/theta, +/-theta)</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">r</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">r</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="varName">r</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="varName">r</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span>

            <span class="lineComment">// (+/-1/theta, +/-theta, 0)</span>
            <span class="operator">-</span><span class="varName">r</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">r</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>
            <span class="varName">r</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="varName">r</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>

            <span class="lineComment">// (+/-theta, 0, +/-1/theta)</span>
            <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">r</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">r</span><span class="delimiter">,</span>
            <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="varName">r</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="varName">r</span>
        <span class="operator">]</span><span class="operator">.</span><span class="identifier">toVectors</span><span class="delimiter">,</span>
        <span class="operator">[</span>
            <span class="number">3</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> 	<span class="number">3</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> <span class="number">15</span><span class="delimiter">,</span> 	<span class="number">3</span><span class="delimiter">,</span> <span class="number">15</span><span class="delimiter">,</span> <span class="number">13</span><span class="delimiter">,</span>
            <span class="number">7</span><span class="delimiter">,</span> <span class="number">19</span><span class="delimiter">,</span> <span class="number">17</span><span class="delimiter">,</span> 	<span class="number">7</span><span class="delimiter">,</span> <span class="number">17</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> 	<span class="number">7</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">15</span><span class="delimiter">,</span>
            <span class="number">17</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span> 	<span class="number">17</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span> 	<span class="number">17</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span>
            <span class="number">8</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">16</span><span class="delimiter">,</span> 	<span class="number">8</span><span class="delimiter">,</span> <span class="number">16</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> 	<span class="number">8</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span>
            <span class="number">0</span><span class="delimiter">,</span> <span class="number">12</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">18</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">18</span><span class="delimiter">,</span> <span class="number">16</span><span class="delimiter">,</span>
            <span class="number">6</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> 	<span class="number">6</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">13</span><span class="delimiter">,</span> 	<span class="number">6</span><span class="delimiter">,</span> <span class="number">13</span><span class="delimiter">,</span> <span class="number">15</span><span class="delimiter">,</span>
            <span class="number">2</span><span class="delimiter">,</span> <span class="number">16</span><span class="delimiter">,</span> <span class="number">18</span><span class="delimiter">,</span> 	<span class="number">2</span><span class="delimiter">,</span> <span class="number">18</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> 	<span class="number">2</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span> <span class="number">13</span><span class="delimiter">,</span>
            <span class="number">18</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span> 	<span class="number">18</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span> 	<span class="number">18</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">,</span>
            <span class="number">4</span><span class="delimiter">,</span> <span class="number">14</span><span class="delimiter">,</span> <span class="number">12</span><span class="delimiter">,</span> 	<span class="number">4</span><span class="delimiter">,</span> <span class="number">12</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> 	<span class="number">4</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span>
            <span class="number">11</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> 	<span class="number">11</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">19</span><span class="delimiter">,</span> 	<span class="number">11</span><span class="delimiter">,</span> <span class="number">19</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span>
            <span class="number">19</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">14</span><span class="delimiter">,</span> 	<span class="number">19</span><span class="delimiter">,</span> <span class="number">14</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> 	<span class="number">19</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">17</span><span class="delimiter">,</span>
            <span class="number">1</span><span class="delimiter">,</span> <span class="number">12</span><span class="delimiter">,</span> <span class="number">14</span><span class="delimiter">,</span> 	<span class="number">1</span><span class="delimiter">,</span> <span class="number">14</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> 	<span class="number">1</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">9</span>
        <span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>


    <span class="lineComment">// https://github.com/mrdoob/three.js/blob/master/src/geometries/IcosahedronGeometry.js</span>
    <span class="keyword">var</span> <span class="varNameDecl">icosahedron</span>
        <span class="operator">=</span> <span class="keyword">var</span> <span class="varNameDecl">t</span> <span class="operator">=</span> <span class="delimiter">(</span><span class="number">1</span> <span class="operator">+</span> <span class="varName">sqrt</span><span class="delimiter">(</span><span class="number">5</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="operator">/</span> <span class="number">2</span> <span class="keyword">in</span>
            <span class="varName">mesh</span><span class="delimiter">(</span><span class="operator">[</span>
                <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>   <span class="number">1</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>   <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>   <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span>
                <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span>   <span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="varName">t</span><span class="delimiter">,</span>   <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span>   <span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span>
                <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span>   <span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span>   <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="operator">-</span><span class="number">1</span><span class="delimiter">,</span>   <span class="operator">-</span><span class="varName">t</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span>
            <span class="operator">]</span><span class="operator">.</span><span class="identifier">toVectors</span><span class="delimiter">,</span>
            <span class="operator">[</span>
                <span class="number">0</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span> 	<span class="number">0</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span>
                <span class="number">1</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span> 	<span class="number">5</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span>	<span class="number">11</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span>	<span class="number">10</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span>	<span class="number">7</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span>
                <span class="number">3</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> 	<span class="number">3</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span>	<span class="number">3</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span>	<span class="number">3</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span>	<span class="number">3</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span>
                <span class="number">4</span><span class="delimiter">,</span> <span class="number">9</span><span class="delimiter">,</span> <span class="number">5</span><span class="delimiter">,</span> 	<span class="number">2</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">,</span> <span class="number">11</span><span class="delimiter">,</span>	<span class="number">6</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">10</span><span class="delimiter">,</span>	<span class="number">8</span><span class="delimiter">,</span> <span class="number">6</span><span class="delimiter">,</span> <span class="number">7</span><span class="delimiter">,</span>	<span class="number">9</span><span class="delimiter">,</span> <span class="number">8</span><span class="delimiter">,</span> <span class="number">1</span>
            <span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Parametric geometry creation</span>

    <span class="lineComment">// Given a number of points (vectors) arranged as a quad strip of "rows"</span>
    <span class="lineComment">// will return a set of indices representing the triangulated indices.</span>
    <span class="functionDef"><span class="functionType">(Func (Array T0) Int Bool Bool (Array Int))</span><span class="keyword">function</span> <span class="funcName">quadStripToMeshIndices</span><span class="delimiter">(</span><span class="funcParamName">vertices</span><span class="delimiter">,</span> <span class="funcParamName">rows</span><span class="delimiter">,</span> <span class="funcParamName">connectRows</span><span class="delimiter">,</span> <span class="funcParamName">connectCols</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">cols</span> <span class="operator">=</span> <span class="varName">vertices</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">/</span> <span class="varName">rows</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">nr</span> <span class="operator">=</span> <span class="varName">connectRows</span> ? <span class="varName">rows</span> : <span class="varName">rows</span><span class="operator">-</span><span class="number">1</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">nc</span> <span class="operator">=</span> <span class="varName">connectCols</span> ? <span class="varName">cols</span> : <span class="varName">cols</span><span class="operator">-</span><span class="number">1</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">indices</span> <span class="operator">=</span> <span class="operator">[]</span><span class="operator">.</span><span class="identifier">mutable</span><span class="delimiter">;</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">row</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">..</span><span class="varName">nr</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">col</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">..</span><span class="varName">nc</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="lineComment">// Rows increase from bottom to top</span>
                <span class="lineComment">// Columns increase from left to right</span>
                <span class="lineComment">// row r + 1 = ... d c ...</span>
                <span class="lineComment">// row r     = ... a b ...</span>
                <span class="keyword">var</span> <span class="varNameDecl">a</span> <span class="operator">=</span> <span class="varName">col</span> <span class="operator">+</span> <span class="varName">row</span> <span class="operator">*</span> <span class="varName">cols</span><span class="delimiter">;</span>
                <span class="keyword">var</span> <span class="varNameDecl">b</span> <span class="operator">=</span> <span class="delimiter">(</span><span class="varName">col</span><span class="operator">+</span><span class="number">1</span><span class="delimiter">)</span> <span class="operator">%</span> <span class="delimiter">(</span><span class="varName">cols</span><span class="delimiter">)</span> <span class="operator">+</span> <span class="varName">row</span> <span class="operator">*</span> <span class="varName">cols</span><span class="delimiter">;</span>
                <span class="keyword">var</span> <span class="varNameDecl">c</span> <span class="operator">=</span> <span class="delimiter">(</span><span class="varName">col</span><span class="operator">+</span><span class="number">1</span><span class="delimiter">)</span> <span class="operator">%</span> <span class="delimiter">(</span><span class="varName">cols</span><span class="delimiter">)</span> <span class="operator">+</span> <span class="delimiter">(</span><span class="varName">row</span><span class="operator">+</span><span class="number">1</span><span class="delimiter">)</span> <span class="operator">%</span> <span class="delimiter">(</span><span class="varName">rows</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">cols</span><span class="delimiter">;</span>
                <span class="keyword">var</span> <span class="varNameDecl">d</span> <span class="operator">=</span> <span class="varName">col</span> <span class="operator">+</span> <span class="delimiter">(</span><span class="varName">row</span><span class="operator">+</span><span class="number">1</span><span class="delimiter">)</span> <span class="operator">%</span> <span class="delimiter">(</span><span class="varName">rows</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">cols</span><span class="delimiter">;</span>
                <span class="varName">indices</span> <span class="operator">=</span> <span class="varName">indices</span><span class="operator">.</span><span class="identifier">pushMany</span><span class="delimiter">(</span><span class="operator">[</span><span class="varName">a</span><span class="delimiter">,</span> <span class="varName">b</span><span class="delimiter">,</span> <span class="varName">d</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>
                <span class="varName">indices</span> <span class="operator">=</span> <span class="varName">indices</span><span class="operator">.</span><span class="identifier">pushMany</span><span class="delimiter">(</span><span class="operator">[</span><span class="varName">b</span><span class="delimiter">,</span> <span class="varName">c</span><span class="delimiter">,</span> <span class="varName">d</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">return</span> <span class="varName">indices</span><span class="operator">.</span><span class="identifier">immutable</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    <span class="lineComment">// Converts from UV coordinates to a float3</span>
    </span><span class="functionDef"><span class="functionType">(Func Float2 Float3)</span><span class="keyword">function</span> <span class="funcName">vector</span><span class="delimiter">(</span><span class="funcParamName">uv</span>: <span class="identifier">Float2</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">float3</span><span class="delimiter">(</span><span class="operator">-</span><span class="varName">uv</span><span class="operator">.</span><span class="identifier">x</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">*</span> <span class="varName">uv</span><span class="operator">.</span><span class="identifier">y</span><span class="operator">.</span><span class="identifier">sin</span><span class="delimiter">,</span> <span class="varName">uv</span><span class="operator">.</span><span class="identifier">x</span><span class="operator">.</span><span class="identifier">cos</span><span class="delimiter">,</span> <span class="varName">uv</span><span class="operator">.</span><span class="identifier">x</span><span class="operator">.</span><span class="identifier">sin</span> <span class="operator">*</span> <span class="varName">uv</span><span class="operator">.</span><span class="identifier">y</span><span class="operator">.</span><span class="identifier">sin</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Works for Float, Float2, Float3, and Float4</span>
    </span><span class="functionDef"><span class="functionType">(Func T0 T0 T0 T0)</span><span class="keyword">function</span> <span class="funcName">rescale</span><span class="delimiter">(</span><span class="funcParamName">v</span><span class="delimiter">,</span> <span class="funcParamName">from</span><span class="delimiter">,</span> <span class="funcParamName">length</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">from</span> <span class="operator">+</span> <span class="delimiter">(</span><span class="varName">v</span> <span class="operator">*</span> <span class="varName">length</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Given a function that converts UV coordinates to vectors, creates an</span>
    <span class="lineComment">// array of points (uCount x vCount) starting at uStart,vStart (0,0) going to</span>
    <span class="lineComment">// uLength, vLength (1,1)</span>
    </span><span class="functionDef"><span class="functionType">(Func (Func Float Float Float3) Int Int Float Float Float Float Bool Bool Mesh)</span><span class="keyword">function</span> <span class="funcName">meshFromUV</span><span class="delimiter">(</span><span class="funcParamName">f</span><span class="delimiter">,</span> <span class="funcParamName">uCount</span><span class="delimiter">,</span> <span class="funcParamName">vCount</span><span class="delimiter">,</span> <span class="funcParamName">uStart</span><span class="delimiter">,</span> <span class="funcParamName">vStart</span><span class="delimiter">,</span> <span class="funcParamName">uLength</span><span class="delimiter">,</span> <span class="funcParamName">vLength</span><span class="delimiter">,</span> <span class="funcParamName">uJoin</span><span class="delimiter">,</span> <span class="funcParamName">vJoin</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">uMax</span> <span class="operator">=</span> <span class="varName">uJoin</span> ? <span class="varName">uCount</span><span class="operator">.</span><span class="identifier">float</span> : <span class="delimiter">(</span><span class="varName">uCount</span> <span class="operator">-</span> <span class="number">1</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">float</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">vMax</span> <span class="operator">=</span> <span class="varName">vJoin</span> ? <span class="varName">vCount</span><span class="operator">.</span><span class="identifier">float</span> : <span class="delimiter">(</span><span class="varName">vCount</span> <span class="operator">-</span> <span class="number">1</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">float</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">uvs</span> <span class="operator">=</span> <span class="varName">cartesianProduct</span><span class="delimiter">(</span><span class="number">0</span><span class="operator">..</span><span class="varName">uCount</span><span class="delimiter">,</span> <span class="number">0</span><span class="operator">..</span><span class="varName">vCount</span><span class="delimiter">,</span> <span class="delimiter">(</span><span class="identifier">u</span><span class="delimiter">,</span> <span class="identifier">v</span><span class="delimiter">)</span>
            <span class="operator">=&gt;</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">u</span> <span class="operator">/</span> <span class="varName">uMax</span> <span class="operator">*</span> <span class="varName">uLength</span> <span class="operator">+</span> <span class="varName">uStart</span><span class="delimiter">,</span> <span class="varName">v</span> <span class="operator">/</span> <span class="varName">vMax</span> <span class="operator">*</span> <span class="varName">vLength</span> <span class="operator">+</span> <span class="varName">vStart</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">points</span> <span class="operator">=</span> <span class="varName">uvs</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">uvw</span> <span class="operator">=&gt;</span> <span class="varName">f</span><span class="delimiter">(</span><span class="varName">uvw</span><span class="operator">.</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="varName">uvw</span><span class="operator">.</span><span class="identifier">y</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">indices</span> <span class="operator">=</span> <span class="varName">quadStripToMeshIndices</span><span class="delimiter">(</span><span class="varName">points</span><span class="delimiter">,</span> <span class="varName">vCount</span><span class="delimiter">,</span> <span class="varName">uJoin</span><span class="delimiter">,</span> <span class="varName">vJoin</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">points</span><span class="delimiter">,</span> <span class="varName">indices</span><span class="delimiter">,</span> <span class="varName">uvs</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Func Float Float Float3) Int Mesh)</span><span class="keyword">function</span> <span class="funcName">meshFromUV</span><span class="delimiter">(</span><span class="funcParamName">f</span><span class="delimiter">,</span> <span class="funcParamName">segments</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">f</span><span class="delimiter">,</span> <span class="varName">segments</span><span class="delimiter">,</span> <span class="bool">true</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Func Float Float Float3) Int Bool Mesh)</span><span class="keyword">function</span> <span class="funcName">meshFromUV</span><span class="delimiter">(</span><span class="funcParamName">f</span><span class="delimiter">,</span> <span class="funcParamName">segments</span><span class="delimiter">,</span> <span class="funcParamName">join</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">f</span><span class="delimiter">,</span> <span class="varName">segments</span><span class="delimiter">,</span> <span class="varName">segments</span><span class="delimiter">,</span> <span class="number">0.0</span><span class="delimiter">,</span> <span class="number">0.0</span><span class="delimiter">,</span> <span class="number">1.0</span><span class="delimiter">,</span> <span class="number">1.0</span><span class="delimiter">,</span> <span class="varName">join</span><span class="delimiter">,</span> <span class="varName">join</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Given UV coordinates on the surface of a sphere u=[0,1), v=[0,1) computes the 3D location.</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">spherePoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="operator">-</span><span class="varName">cos</span><span class="delimiter">(</span><span class="varName">u</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">sin</span><span class="delimiter">(</span><span class="varName">v</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">,</span> <span class="varName">cos</span><span class="delimiter">(</span><span class="varName">v</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">,</span> <span class="varName">sin</span><span class="delimiter">(</span><span class="varName">u</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">sin</span><span class="delimiter">(</span><span class="varName">v</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Int Mesh)</span><span class="keyword">function</span> <span class="funcName">sphere</span><span class="delimiter">(</span><span class="funcParamName">segments</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">spherePoint</span><span class="delimiter">,</span> <span class="varName">segments</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh)</span><span class="keyword">function</span> <span class="funcName">sphere</span><span class="delimiter">()</span>
        <span class="operator">=</span> <span class="varName">sphere</span><span class="delimiter">(</span><span class="number">32</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Given UV coordinates on the surface of a cylinder u=[0,1), v=[0,1) computes the 3D location.</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Int Float3)</span><span class="keyword">function</span> <span class="funcName">cylinderPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">sin</span><span class="delimiter">(</span><span class="varName">u</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">,</span> <span class="varName">v</span> <span class="operator">*</span> <span class="number">2</span><span class="delimiter">,</span> <span class="varName">cos</span><span class="delimiter">(</span><span class="varName">u</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Int Mesh)</span><span class="keyword">function</span> <span class="funcName">cylinder</span><span class="delimiter">(</span><span class="funcParamName">segments</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">cylinderPoint</span><span class="delimiter">,</span> <span class="varName">segments</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh)</span><span class="keyword">function</span> <span class="funcName">cylinder</span><span class="delimiter">()</span>
        <span class="operator">=</span> <span class="varName">cylinder</span><span class="delimiter">(</span><span class="number">16</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Float Float Int Mesh)</span><span class="keyword">function</span> <span class="funcName">torus</span><span class="delimiter">(</span><span class="funcParamName">r1</span><span class="delimiter">,</span> <span class="funcParamName">r2</span><span class="delimiter">,</span> <span class="funcParamName">segments</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="delimiter">(</span><span class="identifier">u</span><span class="delimiter">,</span> <span class="identifier">v</span><span class="delimiter">)</span> <span class="operator">=&gt;</span> <span class="varName">torusPoint</span><span class="delimiter">(</span><span class="varName">u</span><span class="delimiter">,</span> <span class="varName">v</span><span class="delimiter">,</span> <span class="varName">r1</span><span class="delimiter">,</span> <span class="varName">r2</span><span class="delimiter">)</span><span class="delimiter">,</span> <span class="varName">segments</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">// Given UV coordinates u=[0,1), v=[0,1), and a major radius (donut)</span>
    <span class="lineComment">// and a minor radius (tube) computes the 3D location of the torus</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">torusPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">,</span> <span class="funcParamName">r1</span><span class="delimiter">,</span> <span class="funcParamName">r2</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span>
            <span class="delimiter">(</span><span class="varName">r1</span> <span class="operator">+</span> <span class="varName">r2</span> <span class="operator">*</span> <span class="varName">cos</span><span class="delimiter">(</span><span class="varName">v</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">cos</span><span class="delimiter">(</span><span class="varName">u</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">,</span>
            <span class="delimiter">(</span><span class="varName">r1</span> <span class="operator">+</span> <span class="varName">r2</span> <span class="operator">*</span> <span class="varName">cos</span><span class="delimiter">(</span><span class="varName">v</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">sin</span><span class="delimiter">(</span><span class="varName">u</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">,</span>
            <span class="varName">r2</span> <span class="operator">*</span> <span class="varName">sin</span><span class="delimiter">(</span><span class="varName">v</span><span class="operator">*</span><span class="number">2.0</span><span class="operator">*</span><span class="varName">pi</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh)</span><span class="keyword">function</span> <span class="funcName">torus</span><span class="delimiter">()</span>
        <span class="operator">=</span> <span class="varName">torus</span><span class="delimiter">(</span><span class="number">2</span><span class="delimiter">,</span> <span class="number">0.5</span><span class="delimiter">,</span> <span class="number">32</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh Int)</span><span class="keyword">function</span> <span class="funcName">vertexCount</span><span class="delimiter">(</span><span class="funcParamName">mesh</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="operator">.</span><span class="identifier">vertexBuffer</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh Int)</span><span class="keyword">function</span> <span class="funcName">faceCount</span><span class="delimiter">(</span><span class="funcParamName">mesh</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="operator">.</span><span class="identifier">indexBuffer</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">/</span> <span class="number">3</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Float) (Array Float3))</span><span class="keyword">function</span> <span class="funcName">toVectors</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="operator">/</span><span class="number">3</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">*</span><span class="number">3</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">*</span><span class="number">3</span><span class="operator">+</span><span class="number">1</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">*</span><span class="number">3</span><span class="operator">+</span><span class="number">2</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh (Array Float3) Mesh)</span><span class="keyword">function</span> <span class="funcName">setVertices</span><span class="delimiter">(</span><span class="funcParamName">m</span><span class="delimiter">,</span> <span class="funcParamName">points</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">points</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">indexBuffer</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">uvBuffer</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">colorBuffer</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh (Array Float3) Mesh)</span><span class="keyword">function</span> <span class="funcName">setVertexColors</span><span class="delimiter">(</span><span class="funcParamName">m</span><span class="delimiter">,</span> <span class="funcParamName">colors</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">m</span><span class="operator">.</span><span class="identifier">vertexBuffer</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">indexBuffer</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">uvBuffer</span><span class="delimiter">,</span> <span class="varName">colors</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh (Array Float3) Mesh)</span><span class="keyword">function</span> <span class="funcName">setVertexUVs</span><span class="delimiter">(</span><span class="funcParamName">m</span><span class="delimiter">,</span> <span class="funcParamName">uvs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">mesh</span><span class="delimiter">(</span><span class="varName">m</span><span class="operator">.</span><span class="identifier">vertexBuffer</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">indexBuffer</span><span class="delimiter">,</span> <span class="varName">uvs</span><span class="delimiter">,</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">colorBuffer</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh (Func Float3 Float3) Mesh)</span><span class="keyword">function</span> <span class="funcName">transform</span><span class="delimiter">(</span><span class="funcParamName">m</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">setVertices</span><span class="delimiter">(</span><span class="varName">m</span><span class="operator">.</span><span class="identifier">vertexBuffer</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="varName">f</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh Float3 Mesh)</span><span class="keyword">function</span> <span class="funcName">translate</span><span class="delimiter">(</span><span class="funcParamName">m</span><span class="delimiter">,</span> <span class="funcParamName">amount</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">transform</span><span class="delimiter">(</span><span class="identifier">v</span> <span class="operator">=&gt;</span> <span class="varName">v</span> <span class="operator">+</span> <span class="varName">amount</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh Float3 Mesh)</span><span class="keyword">function</span> <span class="funcName">scale</span><span class="delimiter">(</span><span class="funcParamName">m</span><span class="delimiter">,</span> <span class="funcParamName">amount</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">m</span><span class="operator">.</span><span class="identifier">transform</span><span class="delimiter">(</span><span class="identifier">v</span> <span class="operator">=&gt;</span> <span class="varName">v</span> <span class="operator">*</span> <span class="varName">amount</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">kleinPoint</span><span class="delimiter">(</span><span class="funcParamName">a</span><span class="delimiter">,</span> <span class="funcParamName">b</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">u</span> <span class="operator">=</span> <span class="varName">a</span> <span class="operator">*</span> <span class="varName">pi</span> <span class="operator">*</span> <span class="number">2.0</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">v</span> <span class="operator">=</span> <span class="varName">b</span> <span class="operator">*</span> <span class="varName">pi</span> <span class="operator">*</span> <span class="number">2.0</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">x</span> <span class="operator">=</span> <span class="number">0.0</span><span class="delimiter">,</span> <span class="varNameDecl">y</span> <span class="operator">=</span> <span class="number">0.0</span><span class="delimiter">,</span> <span class="varNameDecl">z</span> <span class="operator">=</span> <span class="number">0.0</span><span class="delimiter">;</span>
        <span class="keyword">if</span> <span class="delimiter">(</span><span class="varName">u</span> <span class="operator">&lt;</span> <span class="varName">pi</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="varName">x</span> <span class="operator">=</span> <span class="number">3.0</span> <span class="operator">*</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">*</span> <span class="delimiter">(</span> <span class="number">1.0</span> <span class="operator">+</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">sin</span> <span class="delimiter">)</span> <span class="operator">+</span> <span class="delimiter">(</span> <span class="number">2.0</span> <span class="operator">*</span> <span class="delimiter">(</span> <span class="number">1.0</span> <span class="operator">-</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">/</span> <span class="number">2.0</span> <span class="delimiter">)</span> <span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">*</span> <span class="varName">v</span><span class="operator">.</span><span class="identifier">cos</span><span class="delimiter">;</span>
            <span class="varName">z</span> <span class="operator">=</span> <span class="operator">-</span><span class="number">8.0</span> <span class="operator">*</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">sin</span> <span class="operator">-</span> <span class="number">2.0</span> <span class="operator">*</span> <span class="delimiter">(</span> <span class="number">1.0</span> <span class="operator">-</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">/</span> <span class="number">2.0</span> <span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">sin</span> <span class="operator">*</span> <span class="varName">v</span><span class="operator">.</span><span class="identifier">cos</span><span class="delimiter">;</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="varName">x</span> <span class="operator">=</span> <span class="number">3.0</span> <span class="operator">*</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">*</span> <span class="delimiter">(</span> <span class="number">1.0</span> <span class="operator">+</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">sin</span> <span class="delimiter">)</span> <span class="operator">+</span> <span class="delimiter">(</span> <span class="number">2.0</span> <span class="operator">*</span> <span class="delimiter">(</span> <span class="number">1.0</span> <span class="operator">-</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">/</span> <span class="number">2.0</span> <span class="delimiter">)</span> <span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">cos</span><span class="delimiter">(</span> <span class="varName">v</span> <span class="operator">+</span> <span class="varName">pi</span> <span class="delimiter">)</span><span class="delimiter">;</span>
            <span class="varName">z</span> <span class="operator">=</span> <span class="operator">-</span><span class="number">8.0</span> <span class="operator">*</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">sin</span><span class="delimiter">;</span>
        <span class="delimiter">}</span>
        <span class="varName">y</span> <span class="operator">=</span> <span class="operator">-</span><span class="number">2.0</span> <span class="operator">*</span> <span class="delimiter">(</span> <span class="number">1.0</span> <span class="operator">-</span> <span class="varName">u</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">/</span> <span class="number">2.0</span> <span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">v</span><span class="operator">.</span><span class="identifier">sin</span><span class="delimiter">;</span>

        <span class="lineComment">// Scale down, because it is big compared to other primitives</span>
        <span class="keyword">return</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">x</span> <span class="operator">/</span> <span class="number">4.0</span><span class="delimiter">,</span> <span class="varName">y</span> <span class="operator">/</span> <span class="number">4.0</span><span class="delimiter">,</span> <span class="varName">z</span> <span class="operator">/</span> <span class="number">4.0</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh)</span><span class="keyword">function</span> <span class="funcName">klein</span><span class="delimiter">()</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">kleinPoint</span><span class="delimiter">,</span> <span class="number">32</span><span class="delimiter">,</span> <span class="bool">false</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">planeXYPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">u</span><span class="delimiter">,</span> <span class="varName">v</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">planeXZPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">u</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="varName">v</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">planeYZPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="number">0</span><span class="delimiter">,</span> <span class="varName">u</span><span class="delimiter">,</span> <span class="varName">v</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">planeYXPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">v</span><span class="delimiter">,</span> <span class="varName">u</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">planeZXPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="varName">v</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">,</span> <span class="varName">u</span><span class="delimiter">)</span><span class="delimiter">;</span>
    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">planeZYPoint</span><span class="delimiter">(</span><span class="funcParamName">u</span><span class="delimiter">,</span> <span class="funcParamName">v</span><span class="delimiter">)</span> <span class="operator">=</span> <span class="varName">vector</span><span class="delimiter">(</span><span class="number">0</span><span class="delimiter">,</span> <span class="varName">v</span><span class="delimiter">,</span> <span class="varName">u</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh)</span><span class="keyword">function</span> <span class="funcName">plane</span><span class="delimiter">()</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">planeXYPoint</span><span class="delimiter">,</span> <span class="number">16</span><span class="delimiter">,</span> <span class="bool">false</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Float Float Float3)</span><span class="keyword">function</span> <span class="funcName">mobiusPoint</span><span class="delimiter">(</span><span class="funcParamName">a</span><span class="delimiter">,</span> <span class="funcParamName">b</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">u</span> <span class="operator">=</span> <span class="varName">a</span> <span class="operator">-</span> <span class="number">0.5</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">v</span> <span class="operator">=</span> <span class="varName">b</span> <span class="operator">*</span> <span class="number">2.0</span> <span class="operator">*</span> <span class="varName">pi</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">vector</span><span class="delimiter">(</span>
            <span class="varName">v</span><span class="operator">.</span><span class="identifier">cos</span> <span class="operator">*</span> <span class="delimiter">(</span><span class="number">2</span> <span class="operator">+</span> <span class="varName">u</span> <span class="operator">*</span> <span class="varName">cos</span><span class="delimiter">(</span> <span class="varName">v</span> <span class="operator">/</span> <span class="number">2</span> <span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">,</span>
            <span class="varName">v</span><span class="operator">.</span><span class="identifier">sin</span> <span class="operator">*</span> <span class="delimiter">(</span><span class="number">2</span> <span class="operator">+</span> <span class="varName">u</span> <span class="operator">*</span> <span class="varName">cos</span><span class="delimiter">(</span> <span class="varName">v</span> <span class="operator">/</span> <span class="number">2</span> <span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">,</span>
            <span class="varName">u</span> <span class="operator">*</span> <span class="varName">sin</span><span class="delimiter">(</span> <span class="varName">v</span> <span class="operator">/</span> <span class="number">2</span> <span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func Mesh)</span><span class="keyword">function</span> <span class="funcName">mobius</span><span class="delimiter">()</span>
        <span class="operator">=</span> <span class="varName">meshFromUV</span><span class="delimiter">(</span><span class="varName">mobiusPoint</span><span class="delimiter">,</span> <span class="number">20</span><span class="delimiter">,</span> <span class="bool">false</span><span class="delimiter">)</span><span class="delimiter">;</span>
</span><span class="delimiter">}</span></div>
</body></html>
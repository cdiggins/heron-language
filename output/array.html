<html><head><title>heron:std.array:0.1</title>
<link rel="stylesheet" type="text/css" href="styles.css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
</head>
<body>
<script>
    // TODO: get all tags with code class. 
    // CHange the 'hideTypes' class to 'showTypes' 
    var typeVis = false;

    function changeClass(e, from, to) {
        className = e.getAttribute("class").replace(from, to);            
        e.setAttribute("class", className);
    }

    function showTypeVis(e) {
        if (typeVis) 
            changeClass(e, "hideTypes", "showTypes");
        else 
            changeClass(e, "showTypes", "hideTypes");
    }
</script>
<div class="code hideTypes"><span class="button">Toggle Types</span><span class="keyword">language</span> <span class="langVer">heron:std:0.1</span><span class="delimiter">;</span>

<span class="keyword">module</span> <span class="moduleName">heron:std.array:0.1</span>
<span class="delimiter">{</span>
    <span class="keyword">function</span> <span class="funcName">unit</span><span class="delimiter">(</span><span class="funcParamName">x</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="operator">[</span><span class="varName">x</span><span class="operator">]</span><span class="delimiter">;</span>

    <span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 T1) (Array T1))</span><span class="keyword">function</span> <span class="funcName">map</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">array</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">,</span> <span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">f</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 Int T1) (Array T1))</span><span class="keyword">function</span> <span class="funcName">mapWithIndex</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">array</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">,</span> <span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">f</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">i</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func Int T1) (Array T1))</span><span class="keyword">function</span> <span class="funcName">mapIndex</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">array</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">,</span> <span class="varName">f</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func T0 T0 T0)</span><span class="keyword">function</span> <span class="funcName">min</span><span class="delimiter">(</span><span class="funcParamName">x</span><span class="delimiter">,</span> <span class="funcParamName">y</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">x</span> <span class="operator">&lt;=</span> <span class="varName">y</span> ? <span class="varName">x</span> : <span class="varName">y</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func T0 T0 T0)</span><span class="keyword">function</span> <span class="funcName">max</span><span class="delimiter">(</span><span class="funcParamName">x</span><span class="delimiter">,</span> <span class="funcParamName">y</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">x</span> <span class="operator">&gt;=</span> <span class="varName">y</span> ? <span class="varName">x</span> : <span class="varName">y</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">shorter</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">&lt;=</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span> ? <span class="varName">xs</span> : <span class="varName">ys</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">longer</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">&gt;=</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span> ? <span class="varName">xs</span> : <span class="varName">ys</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Bool)</span><span class="keyword">function</span> <span class="funcName">empty</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">==</span> <span class="number">0</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array Int) (Array T0))</span><span class="keyword">function</span> <span class="funcName">selectByIndex</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">indices</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">indices</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">at</span><span class="delimiter">(</span><span class="varName">i</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array Int))</span><span class="keyword">function</span> <span class="funcName">indices</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="number">0</span> <span class="operator">..</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T1) (Func T0 T1 T2) (Array T2))</span><span class="keyword">function</span> <span class="funcName">zip</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">&lt;=</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span>
            ? <span class="varName">xs</span><span class="operator">.</span><span class="identifier">mapWithIndex</span><span class="delimiter">(</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="identifier">i</span><span class="delimiter">)</span> <span class="operator">=&gt;</span> <span class="varName">f</span><span class="delimiter">(</span><span class="varName">x</span><span class="delimiter">,</span> <span class="varName">ys</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
            : <span class="varName">ys</span><span class="operator">.</span><span class="identifier">mapWithIndex</span><span class="delimiter">(</span><span class="delimiter">(</span><span class="identifier">y</span><span class="delimiter">,</span> <span class="identifier">i</span><span class="delimiter">)</span> <span class="operator">=&gt;</span> <span class="varName">f</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">y</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 Bool) Bool)</span><span class="keyword">function</span> <span class="funcName">all</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">p</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="bool">true</span><span class="delimiter">,</span> <span class="delimiter">(</span><span class="identifier">prev</span><span class="delimiter">,</span> <span class="identifier">x</span><span class="delimiter">)</span> <span class="operator">=&gt;</span> <span class="varName">prev</span> <span class="operator">&amp;&</span> <span class="varName">p</span><span class="delimiter">(</span><span class="varName">x</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 Bool) Bool)</span><span class="keyword">function</span> <span class="funcName">any</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">p</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="bool">false</span><span class="delimiter">,</span> <span class="delimiter">(</span><span class="identifier">prev</span><span class="delimiter">,</span> <span class="identifier">x</span><span class="delimiter">)</span> <span class="operator">=&gt;</span> <span class="varName">prev</span> <span class="operator">||</span> <span class="varName">p</span><span class="delimiter">(</span><span class="varName">x</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    <span class="lineComment">//function count(xs, p)
</span>
    <span class="lineComment">//    = xs.reduce(0, (prev, x) =&gt; p(x) ? prev + 1 : prev);
</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T1) Bool)</span><span class="keyword">function</span> <span class="funcName">eq</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">==</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 Bool) (Array T0))</span><span class="keyword">function</span> <span class="funcName">filter</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">p</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">ys</span> <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">mutable</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">i</span> <span class="operator">=</span> <span class="number">0</span><span class="delimiter">;</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">x</span> <span class="keyword">in</span> <span class="varName">xs</span><span class="delimiter">)</span>
            <span class="keyword">if</span> <span class="delimiter">(</span><span class="varName">p</span><span class="delimiter">(</span><span class="varName">x</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="varName">ys</span><span class="operator">[</span><span class="varName">i</span><span class="operator">++</span><span class="operator">]</span> <span class="operator">=</span> <span class="varName">x</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">immutable</span><span class="operator">.</span><span class="identifier">take</span><span class="delimiter">(</span><span class="varName">i</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func T0 Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">repeat</span><span class="delimiter">(</span><span class="funcParamName">x</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">n</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">x</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 T0 T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">prefixScan</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">op</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">empty</span><span class="delimiter">)</span> <span class="keyword">return</span> <span class="varName">xs</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">ys</span> <span class="operator">=</span> <span class="varName">xs</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span><span class="identifier">repeat</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">mutable</span><span class="delimiter">;</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">i</span> <span class="keyword">in</span> <span class="number">1</span> <span class="operator">..</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">)</span>
            <span class="varName">ys</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span> <span class="operator">=</span> <span class="varName">op</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">ys</span><span class="operator">[</span><span class="varName">i</span><span class="operator">-</span><span class="number">1</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">immutable</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">adjacentDifferences</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">indices</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">i</span> <span class="operator">&gt;</span> <span class="number">0</span> ? <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span> <span class="operator">-</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">-</span><span class="number">1</span><span class="operator">]</span> : <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">slice</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">from</span><span class="delimiter">,</span> <span class="funcParamName">to</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="varName">from</span> <span class="operator">..</span> <span class="varName">to</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">at</span><span class="delimiter">(</span><span class="varName">i</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">stride</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">/</span> <span class="varName">n</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span> <span class="operator">*</span> <span class="varName">n</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">stride</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">from</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">/</span> <span class="varName">n</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">from</span> <span class="operator">+</span> <span class="varName">i</span> <span class="operator">*</span> <span class="varName">n</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array (Array T0)))</span><span class="keyword">function</span> <span class="funcName">strides</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">n</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">stride</span><span class="delimiter">(</span><span class="varName">i</span><span class="delimiter">,</span> <span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array (Array T0)))</span><span class="keyword">function</span> <span class="funcName">slices</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">n</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">slice</span><span class="delimiter">(</span><span class="varName">i</span> <span class="operator">*</span> <span class="varName">n</span><span class="delimiter">,</span> <span class="delimiter">(</span><span class="varName">i</span><span class="operator">+</span><span class="number">1</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">take</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">slice</span><span class="delimiter">(</span><span class="number">0</span><span class="delimiter">,</span> <span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">take</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">i</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">skip</span><span class="delimiter">(</span><span class="varName">i</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">take</span><span class="delimiter">(</span><span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">skip</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">slice</span><span class="delimiter">(</span><span class="varName">n</span><span class="delimiter">,</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">drop</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">take</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">last</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">skip</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="operator">-</span><span class="varName">n</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T1 (Array T0))</span><span class="keyword">function</span> <span class="funcName">reverse</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">indices</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="operator">-</span><span class="number">1</span><span class="operator">-</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func Int (Func Int T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">gen</span><span class="delimiter">(</span><span class="funcParamName">cnt</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="delimiter">(</span><span class="number">0</span> <span class="operator">..</span> <span class="varName">cnt</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="varName">f</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">concat</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">gen</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">+</span> <span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">,</span> <span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">i</span> <span class="operator">&lt;</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> ? <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span> : <span class="varName">ys</span><span class="operator">[</span><span class="varName">i</span> <span class="operator">-</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">cut</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">from</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">gen</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="varName">n</span><span class="delimiter">,</span> <span class="identifier">i</span> <span class="operator">=&gt;</span> <span class="varName">i</span> <span class="operator">&lt;</span> <span class="varName">from</span> ? <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span> : <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span> <span class="operator">+</span> <span class="varName">n</span><span class="operator">]</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">splice</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">from</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">take</span><span class="delimiter">(</span><span class="varName">from</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">concat</span><span class="delimiter">(</span><span class="varName">ys</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">concat</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">skip</span><span class="delimiter">(</span><span class="varName">from</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Float) Float)</span><span class="keyword">function</span> <span class="funcName">sum</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="number">0.0</span><span class="delimiter">,</span> <span class="varName">op+</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Float) Float)</span><span class="keyword">function</span> <span class="funcName">product</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="number">1.0</span><span class="delimiter">,</span> <span class="varName">op*</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Float) Float)</span><span class="keyword">function</span> <span class="funcName">average</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">sum</span> <span class="operator">/</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="operator">.</span><span class="identifier">float</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T0)</span><span class="keyword">function</span> <span class="funcName">min</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">min</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T0)</span><span class="keyword">function</span> <span class="funcName">max</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="varName">xs</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="delimiter">,</span> <span class="varName">max</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (ArrayBuilder T0) Int Int (ArrayBuilder T0))</span><span class="keyword">function</span> <span class="funcName">swapElements</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">i</span><span class="delimiter">,</span> <span class="funcParamName">j</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">tmp</span> <span class="operator">=</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span><span class="delimiter">;</span>
        <span class="varName">xs</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span> <span class="operator">=</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">j</span><span class="operator">]</span><span class="delimiter">;</span>
        <span class="varName">xs</span><span class="operator">[</span><span class="varName">j</span><span class="operator">]</span> <span class="operator">=</span> <span class="varName">tmp</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">xs</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Int Int)</span><span class="keyword">function</span> <span class="funcName">partition</span><span class="delimiter">(</span><span class="funcParamName">a</span><span class="delimiter">,</span> <span class="funcParamName">lo</span><span class="delimiter">,</span> <span class="funcParamName">hi</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">p</span> <span class="operator">=</span> <span class="varName">a</span><span class="operator">[</span><span class="varName">lo</span><span class="operator">]</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">i</span> <span class="operator">=</span> <span class="varName">lo</span> <span class="operator">-</span> <span class="number">1</span><span class="delimiter">;</span>
        <span class="keyword">var</span> <span class="varNameDecl">j</span> <span class="operator">=</span> <span class="varName">hi</span> <span class="operator">+</span> <span class="number">1</span><span class="delimiter">;</span>
        <span class="keyword">while</span> <span class="delimiter">(</span><span class="bool">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">do</span> <span class="delimiter">{</span> <span class="varName">i</span><span class="operator">++</span><span class="delimiter">;</span> <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><span class="varName">a</span><span class="operator">[</span><span class="varName">i</span><span class="operator">]</span> <span class="operator">&lt;</span> <span class="varName">p</span><span class="delimiter">)</span><span class="delimiter">;</span>
            <span class="keyword">do</span> <span class="delimiter">{</span> <span class="varName">j</span><span class="operator">--</span><span class="delimiter">;</span> <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><span class="varName">a</span><span class="operator">[</span><span class="varName">j</span><span class="operator">]</span> <span class="operator">&gt;</span> <span class="varName">p</span><span class="delimiter">)</span><span class="delimiter">;</span>
            <span class="keyword">if</span> <span class="delimiter">(</span><span class="varName">i</span> <span class="operator">&gt;=</span> <span class="varName">j</span><span class="delimiter">)</span> <span class="keyword">return</span> <span class="varName">j</span><span class="delimiter">;</span>
            <span class="varName">swapElements</span><span class="delimiter">(</span><span class="varName">a</span><span class="delimiter">,</span> <span class="varName">i</span><span class="delimiter">,</span> <span class="varName">j</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Int (Array T0))</span><span class="keyword">function</span> <span class="funcName">qsort</span><span class="delimiter">(</span><span class="funcParamName">a</span><span class="delimiter">,</span> <span class="funcParamName">lo</span><span class="delimiter">,</span> <span class="funcParamName">hi</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span><span class="varName">lo</span> <span class="operator">&lt;</span> <span class="varName">hi</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">var</span> <span class="varNameDecl">p</span> <span class="operator">=</span> <span class="varName">partition</span><span class="delimiter">(</span><span class="varName">a</span><span class="delimiter">,</span> <span class="varName">lo</span><span class="delimiter">,</span> <span class="varName">hi</span><span class="delimiter">)</span><span class="delimiter">;</span>
            <span class="varName">qsort</span><span class="delimiter">(</span><span class="varName">a</span><span class="delimiter">,</span> <span class="varName">lo</span><span class="delimiter">,</span> <span class="varName">p</span><span class="delimiter">)</span><span class="delimiter">;</span>
            <span class="varName">qsort</span><span class="delimiter">(</span><span class="varName">a</span><span class="delimiter">,</span> <span class="varName">p</span><span class="operator">+</span><span class="number">1</span><span class="delimiter">,</span> <span class="varName">hi</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="delimiter">}</span>
        <span class="keyword">return</span> <span class="varName">a</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">sort</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">mutable</span><span class="operator">.</span><span class="identifier">qsort</span><span class="delimiter">(</span><span class="number">0</span><span class="delimiter">,</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="operator">-</span><span class="number">1</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">immutable</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array Int) Int)</span><span class="keyword">function</span> <span class="funcName">median</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">ys</span> <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">sort</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="delimiter">(</span><span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="number">1</span><span class="delimiter">)</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span>
            ? <span class="varName">ys</span><span class="operator">[</span><span class="delimiter">(</span><span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="number">1</span><span class="delimiter">)</span> <span class="operator">/</span> <span class="number">2</span><span class="operator">]</span>
            : <span class="varName">ys</span><span class="operator">[</span><span class="delimiter">(</span><span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="number">2</span><span class="delimiter">)</span> <span class="operator">/</span> <span class="number">2</span><span class="operator">]</span> <span class="operator">+</span> <span class="varName">ys</span><span class="operator">[</span><span class="varName">ys</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">/</span> <span class="number">2</span><span class="operator">]</span> <span class="operator">/</span> <span class="number">2</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) Int Bool)</span><span class="keyword">function</span> <span class="funcName">inRange</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">n</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">n</span> <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&</span> <span class="varName">n</span> <span class="operator">&lt;</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T0)</span><span class="keyword">function</span> <span class="funcName">last</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">[</span><span class="varName">xs</span><span class="operator">.</span><span class="identifier">count</span> <span class="operator">-</span> <span class="number">1</span><span class="operator">]</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T0)</span><span class="keyword">function</span> <span class="funcName">first</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T0))</span><span class="keyword">function</span> <span class="funcName">tail</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">skip</span><span class="delimiter">(</span><span class="number">1</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T1 (Func T1 T0 T1) T1)</span><span class="keyword">function</span> <span class="funcName">reduce</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">acc</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">x</span> <span class="keyword">in</span> <span class="varName">xs</span><span class="delimiter">)</span>
            <span class="varName">acc</span> <span class="operator">=</span> <span class="varName">f</span><span class="delimiter">(</span><span class="varName">acc</span><span class="delimiter">,</span> <span class="varName">x</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">acc</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array (Array T0)) (Array T0))</span><span class="keyword">function</span> <span class="funcName">flatten</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">reduce</span><span class="delimiter">(</span><span class="operator">[]</span><span class="delimiter">,</span> <span class="varName">concat</span><span class="delimiter">)</span><span class="delimiter">;</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Func T0 (Array T1)) (Array T1))</span><span class="keyword">function</span> <span class="funcName">flatMap</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="varName">f</span><span class="delimiter">)</span><span class="operator">.</span><span class="identifier">flatten</span><span class="delimiter">;</span>

    <span class="lineComment">// TODO: rewrite using flatMap, but that is slow for now. I will need to write an optimizer    
</span>
    </span><span class="functionDef"><span class="functionType">(Func (Array T0) (Array T1) (Func T0 T1 T2) (Array T2))</span><span class="keyword">function</span> <span class="funcName">cartesianProduct</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">ys</span><span class="delimiter">,</span> <span class="funcParamName">f</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <span class="varNameDecl">r</span> <span class="operator">=</span> <span class="operator">[]</span><span class="operator">.</span><span class="identifier">mutable</span><span class="delimiter">;</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">x</span> <span class="keyword">in</span> <span class="varName">xs</span><span class="delimiter">)</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><span class="keyword">var</span> <span class="identifier">y</span> <span class="keyword">in</span> <span class="varName">ys</span><span class="delimiter">)</span> 
                <span class="varName">r</span><span class="operator">.</span><span class="identifier">push</span><span class="delimiter">(</span><span class="varName">f</span><span class="delimiter">(</span><span class="varName">x</span><span class="delimiter">,</span> <span class="varName">y</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">;</span>
        <span class="keyword">return</span> <span class="varName">r</span><span class="operator">.</span><span class="identifier">immutable</span><span class="delimiter">;</span>
    <span class="delimiter">}</span>

    </span><span class="functionDef"><span class="functionType">(Func (Array T0) T1 (Array T1))</span><span class="keyword">function</span> <span class="funcName">setAll</span><span class="delimiter">(</span><span class="funcParamName">xs</span><span class="delimiter">,</span> <span class="funcParamName">x</span><span class="delimiter">)</span>
        <span class="operator">=</span> <span class="varName">xs</span><span class="operator">.</span><span class="identifier">map</span><span class="delimiter">(</span><span class="identifier">_</span> <span class="operator">=&gt;</span> <span class="varName">x</span><span class="delimiter">)</span><span class="delimiter">;</span>
</span><span class="delimiter">}</span></div>
</body></html>
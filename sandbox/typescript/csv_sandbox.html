<html>
<head>
<title>CSV Parsing with Myna</title>
</head>
<body>
<script src="main.js"></script>
<script src="csv_grammar.js"></script>
<script src="jquery.min.js"></script>
<script>
let m = Myna;
let g = new CsvGrammar(m);

function parseCsvFile(f) {
    let startTime = performance.now();
    let result = m.parse(g.file, f);
    let elapsedTime = performance.now() - startTime;
    console.log("Time elapsed = " + elapsedTime + " msec");
    console.log(result);
}

// Adapted from: http://stackoverflow.com/questions/14446447/javascript-read-local-text-file
function parseRemoteFile(url)
{
    let rawFile = new XMLHttpRequest();
    rawFile.open("GET", url, false);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState !== 4) 
            return;
        if(rawFile.status !== 200 && rawFile.status != 0)
            return;
        let result = rawFile.responseText;
        parseCsvFile(result);                    
    }
    rawFile.send(null);
}

function parseLocalFile(event) {
    let reader = new FileReader();
    let input = event.target;
    reader.onload = function() {
        let text = reader.result;
        parseCsvFile(text);
    }
    reader.readAsText(input.files[0]);
}

console.log(m.grammarToString(g));

parseRemoteFile("csv_big.csv");
</script>
<input type='file' id='file-input' accept='text/plain' onchange='parseLocalFile(event)'/>
</body>